<!DOCTYPE html>
<html>
<head>
  <title>Full Screen Camera with RGB Range Highlight</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      background: black;
      font-family: sans-serif;
    }
    #canvas {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      touch-action: none;
    }
    #info {
      position: absolute;
      bottom: 10px; left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 14px;
    }
    #dialog {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #222; color: white;
      width: 80%; max-width: 400px;
      height: 50%;
      padding: 16px;
      border-radius: 16px;
      display: none;
      box-shadow: 0 0 30px rgba(0,0,0,0.7);
      overflow: auto; z-index: 10;
    }
    #dialog h3 {
      margin: 0 0 10px;
      font-size: 16px;
      text-align: center;
    }
    .row {
      display: flex;
      align-items: center;
      margin: 8px 0;
    }
    .row label { width: 30px; }
    .row input {
      margin-left: 8px;
      width: 60px;
      background: #333; border: 1px solid #555;
      color: white; border-radius: 6px;
      padding: 4px;
    }
    #preview1, #preview2 {
      height: 30px;
      border-radius: 8px;
      margin: 6px 0;
    }
    #buttons {
      text-align: center;
      margin-top: 10px;
    }
    #buttons button {
      margin: 6px;
      padding: 6px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    #okBtn { background: #28a745; color: white; }
    #cancelBtn { background: #dc3545; color: white; }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div id="info">Tap to choose RGB range</div>

  <!-- Dialog -->
  <div id="dialog">
    <h3>Choose RGB Range</h3>

    <div><b>Color 1</b></div>
    <div class="row"><label>R</label><input type="number" id="r1" min="0" max="255"></div>
    <div class="row"><label>G</label><input type="number" id="g1" min="0" max="255"></div>
    <div class="row"><label>B</label><input type="number" id="b1" min="0" max="255"></div>
    <div id="preview1"></div>

    <div><b>Color 2</b></div>
    <div class="row"><label>R</label><input type="number" id="r2" min="0" max="255"></div>
    <div class="row"><label>G</label><input type="number" id="g2" min="0" max="255"></div>
    <div class="row"><label>B</label><input type="number" id="b2" min="0" max="255"></div>
    <div id="preview2"></div>

    <div class="row">
      <label>Tol</label><input type="number" id="tolInput" min="0" max="255" value="40">
    </div>

    <div id="buttons">
      <button id="okBtn">OK</button>
      <button id="cancelBtn">Cancel</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const video = document.createElement("video");
    video.autoplay = true;
    video.playsInline = true;

    let color1 = { r: 200, g: 50, b: 0 };
    let color2 = { r: 100, g: 25, b: 11 };
    let tolerance = 4;

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" }
        });
        video.srcObject = stream;

        video.addEventListener("loadeddata", () => {
          resizeCanvas();
          processFrame();
        });
      } catch (err) {
        console.error("Camera error:", err);
        alert("Could not access the camera. Use HTTPS or localhost.");
      }
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);

    function inRange(r, g, b) {
      const rMin = Math.min(color1.r, color2.r) - tolerance;
      const rMax = Math.max(color1.r, color2.r) + tolerance;
      const gMin = Math.min(color1.g, color2.g) - tolerance;
      const gMax = Math.max(color1.g, color2.g) + tolerance;
      const bMin = Math.min(color1.b, color2.b) - tolerance;
      const bMax = Math.max(color1.b, color2.b) + tolerance;

      return (
        r >= rMin && r <= rMax &&
        g >= gMin && g <= gMax &&
        b >= bMin && b <= bMax
      );
    }

    function processFrame() {
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = frame.data;

      for (let i = 0; i < data.length; i += 4) {
        const r = data[i], g = data[i+1], b = data[i+2];
        if (!inRange(r, g, b)) {
          data[i] *= 0.3;
          data[i+1] *= 0.3;
          data[i+2] *= 0.3;
        }
      }

      ctx.putImageData(frame, 0, 0);
      requestAnimationFrame(processFrame);
    }

    // Dialog
    const dialog = document.getElementById("dialog");
    const r1 = document.getElementById("r1"), g1 = document.getElementById("g1"), b1 = document.getElementById("b1");
    const r2 = document.getElementById("r2"), g2 = document.getElementById("g2"), b2 = document.getElementById("b2");
    const tolInput = document.getElementById("tolInput");
    const preview1 = document.getElementById("preview1");
    const preview2 = document.getElementById("preview2");
    const info = document.getElementById("info");

    function updatePreviews() {
      preview1.style.backgroundColor = `rgb(${r1.value},${g1.value},${b1.value})`;
      preview2.style.backgroundColor = `rgb(${r2.value},${g2.value},${b2.value})`;
    }

    [r1,g1,b1,r2,g2,b2].forEach(el => {
      el.addEventListener("input", updatePreviews);
    });

    canvas.addEventListener("click", () => {
      r1.value = color1.r; g1.value = color1.g; b1.value = color1.b;
      r2.value = color2.r; g2.value = color2.g; b2.value = color2.b;
      tolInput.value = tolerance;
      updatePreviews();
      dialog.style.display = "block";
    });

    document.getElementById("okBtn").addEventListener("click", () => {
      color1 = { r: parseInt(r1.value), g: parseInt(g1.value), b: parseInt(b1.value) };
      color2 = { r: parseInt(r2.value), g: parseInt(g2.value), b: parseInt(b2.value) };
      tolerance = parseInt(tolInput.value);
      info.textContent = `Highlighting between rgb(${color1.r},${color1.g},${color1.b}) and rgb(${color2.r},${color2.g},${color2.b}), tol=${tolerance}`;
      dialog.style.display = "none";
    });

    document.getElementById("cancelBtn").addEventListener("click", () => {
      dialog.style.display = "none";
    });

    startCamera();
  </script>
</body>
</html>
