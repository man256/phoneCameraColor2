<!DOCTYPE html>
<html>
<head>
  <title>Full Screen Camera with RGB + Hue Color Picker</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      background: black;
      font-family: sans-serif;
    }
    #canvas {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      touch-action: none;
    }
    #info {
      position: absolute;
      bottom: 10px; left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 14px;
    }
    #dialog {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      color: white;
      width: 80%; max-width: 420px;
      height: 55%;
      padding: 16px;
      border-radius: 16px;
      display: none;
      box-shadow: 0 0 30px rgba(0,0,0,0.7);
      overflow-y: auto;
      z-index: 10;
    }
    #dialog h3 {
      margin-top: 0; margin-bottom: 10px;
      font-size: 16px; text-align: center;
    }
    .row {
      display: flex;
      align-items: center;
      margin: 10px 0;
    }
    .row label { width: 30px; }
    .row input[type=number] {
      width: 60px; margin-left: 8px;
      background: #333; border: 1px solid #555;
      color: white; border-radius: 6px; padding: 4px;
    }
    .row input[type=range] {
      flex: 1; margin-left: 8px;
    }
    #preview {
      height: 50px;
      border-radius: 8px;
      margin: 10px 0;
    }
    #buttons {
      text-align: center; margin-top: 10px;
    }
    #buttons button {
      margin: 8px; padding: 6px 12px;
      border: none; border-radius: 8px;
      cursor: pointer; font-weight: bold;
    }
    #okBtn { background: #28a745; color: white; }
    #cancelBtn { background: #dc3545; color: white; }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div id="info">Tap to choose highlight color</div>

  <div id="dialog">
    <h3>Choose Color</h3>

    <!-- RGB controls -->
    <div class="row">
      <label>R</label>
      <input type="range" id="rRange" min="0" max="255">
      <input type="number" id="rInput" min="0" max="255">
    </div>
    <div class="row">
      <label>G</label>
      <input type="range" id="gRange" min="0" max="255">
      <input type="number" id="gInput" min="0" max="255">
    </div>
    <div class="row">
      <label>B</label>
      <input type="range" id="bRange" min="0" max="255">
      <input type="number" id="bInput" min="0" max="255">
    </div>

    <!-- HSB controls -->
    <div class="row">
      <label>H</label>
      <input type="range" id="hRange" min="0" max="360">
      <input type="number" id="hInput" min="0" max="360">
    </div>
    <div class="row">
      <label>S</label>
      <input type="range" id="sRange" min="0" max="100">
      <input type="number" id="sInput" min="0" max="100">
    </div>
    <div class="row">
      <label>B</label>
      <input type="range" id="vRange" min="0" max="100">
      <input type="number" id="vInput" min="0" max="100">
    </div>

    <div id="preview"></div>
    <div id="buttons">
      <button id="okBtn">OK</button>
      <button id="cancelBtn">Cancel</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const video = document.createElement("video");
    video.autoplay = true; video.playsInline = true;

    let target = { r: 200, g: 50, b: 50 }; 
    let targetHue = 0;
    const hueTolerance = 20; // degrees

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" }
        });
        video.srcObject = stream;
        video.addEventListener("loadeddata", () => {
          resizeCanvas(); processFrame();
        });
      } catch (err) {
        alert("Camera blocked. Use HTTPS or localhost.");
        console.error(err);
      }
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);

    // RGB->Hue
    function rgbToHue(r,g,b) {
      r/=255; g/=255; b/=255;
      const max=Math.max(r,g,b), min=Math.min(r,g,b);
      let h;
      if(max===min) h=0;
      else if(max===r) h=(60*((g-b)/(max-min))+360)%360;
      else if(max===g) h=(60*((b-r)/(max-min))+120)%360;
      else h=(60*((r-g)/(max-min))+240)%360;
      return h;
    }

    function processFrame() {
      ctx.drawImage(video,0,0,canvas.width,canvas.height);
      const frame = ctx.getImageData(0,0,canvas.width,canvas.height);
      const d=frame.data;
      for(let i=0;i<d.length;i+=4){
        const r=d[i], g=d[i+1], b=d[i+2];
        const h=rgbToHue(r,g,b);
        const dist=Math.min(
          Math.abs(h-targetHue),
          360-Math.abs(h-targetHue)
        );
        if(dist>hueTolerance){
          d[i]*=0.3; d[i+1]*=0.3; d[i+2]*=0.3;
        }
      }
      ctx.putImageData(frame,0,0);
      requestAnimationFrame(processFrame);
    }

    // UI
    const dialog=document.getElementById("dialog");
    const preview=document.getElementById("preview");
    const info=document.getElementById("info");

    const rRange=rInput=document.getElementById("rRange");
    const gRange=gInput=document.getElementById("gRange");
    const bRange=bInput=document.getElementById("bRange");

    // (fix: store references separately)
    const rNum=document.getElementById("rInput");
    const gNum=document.getElementById("gInput");
    const bNum=document.getElementById("bInput");
    const hRange=document.getElementById("hRange");
    const sRange=document.getElementById("sRange");
    const vRange=document.getElementById("vRange");
    const hNum=document.getElementById("hInput");
    const sNum=document.getElementById("sInput");
    const vNum=document.getElementById("vInput");

    function updatePreview() {
      preview.style.backgroundColor = `rgb(${target.r},${target.g},${target.b})`;
    }

    // Sync helper
    function sync(range,input,callback){
      range.addEventListener("input",()=>{input.value=range.value;callback();});
      input.addEventListener("input",()=>{range.value=input.value;callback();});
    }

    sync(rRange,rNum,()=>{
      target.r=parseInt(rRange.value);
      updatePreview();
    });
    sync(gRange,gNum,()=>{
      target.g=parseInt(gRange.value);
      updatePreview();
    });
    sync(bRange,bNum,()=>{
      target.b=parseInt(bRange.value);
      updatePreview();
    });
    sync(hRange,hNum,()=>{
      targetHue=parseInt(hRange.value);
      updatePreview();
    });
    sync(sRange,sNum,updatePreview);
    sync(vRange,vNum,updatePreview);

    canvas.addEventListener("click",()=>{
      rRange.value=target.r; rNum.value=target.r;
      gRange.value=target.g; gNum.value=target.g;
      bRange.value=target.b; bNum.value=target.b;
      hRange.value=Math.round(rgbToHue(target.r,target.g,target.b));
      hNum.value=hRange.value;
      updatePreview();
      dialog.style.display="block";
    });

    document.getElementById("okBtn").addEventListener("click",()=>{
      target={ r:parseInt(rRange.value), g:parseInt(gRange.value), b:parseInt(bRange.value)};
      targetHue=rgbToHue(target.r,target.g,target.b);
      info.textContent=`Highlight hue ${Math.round(targetHue)}Â° rgb(${target.r},${target.g},${target.b})`;
      dialog.style.display="none";
    });

    document.getElementById("cancelBtn").addEventListener("click",()=>{dialog.style.display="none";});

    startCamera();
  </script>
</body>
</html>
